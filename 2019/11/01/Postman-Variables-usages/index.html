<!DOCTYPE html><html lang="ko" prefix="og: http://ogp.me/ns#"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title>Postman: Variables usages · {bbon}</title><meta name="description"><meta name="og:title" content="Postman: Variables usages"><meta name="og:type" content="website"><meta name="og:url" content="http://bbon.me/2019/11/01/Postman-Variables-usages/"><meta name="og:image" content="/images/logo.png"><meta name="og:description"><meta name="twitter:card" content="summary"><meta name="witter:site" content="@bbonkr"><meta name="witter:creator" content="@bbonkr"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" href="/favicon.ico"><link rel="stylesheet" href="/css/chiangmai.css"><link rel="stylesheet" href="/css/prism.css"><link rel="search" type="application/opensearchdescription+xml" href="http://bbon.me/atom.xml" title="{bbon}"><meta name="generator" content="Hexo 5.4.0"><link rel="alternate" href="/atom.xml" title="{bbon}" type="application/atom+xml">
</head><body class="post"><div id="fb-root"></div><div class="wrap"><header><nav class="navi-post"><a class="navi-post-back" href="javascript:history.back()"><i class="fa fa-arrow-left" aria-hidden="true"></i></a><a class="navi-post-home" href="/"><i class="fa fa-home" aria-hidden="true"></i></a></nav></header><main class="post"><div class="post"><article class="post-block"><h1 class="post-title">Postman: Variables usages</h1><div class="post-info"><div class="post-info-profile"><a href="https://github.com/bbonkr" target="_blank"><img src="/images/me.png"></a></div><div class="post-info-details"><div class="post-categories"><a href="/categories/HowTo" target="_self"><span>HOWTO</span></a></div><div class="post-date">2019년 11월 1일</div></div></div><div class="post-share"><div class="fb-like" data-href="http://bbon.me/2019/11/01/Postman-Variables-usages/" data-layout="button_count" data-action="like" data-size="small" data-show-faces="true" data-share="false">                 </div><div class="fb-share-button" data-href="http://bbon.me/2019/11/01/Postman-Variables-usages/" data-layout="button" data-size="small" data-mobile-iframe="true"></div></div><div class="post-content"><p>HTTP API  웹 응용프로그램을 작성할 때,  <a href="https://www.getpostman.com/" target="_blank" rel="noopener">Postman</a> 을 많이 사용합니다.</p>
<p>작성한 API 가 잘 동작하는지 클라이언트에서 사용하는 것과 동일한 요청을 GUI를 통해 실행할 수 있어 매우 편리합니다.</p>
<img src="/2019/11/01/Postman-Variables-usages/postman-variable-usage-001.png" class="">

<p><a href="https://www.getpostman.com/pricing" target="_blank" rel="noopener">무료 요금제</a> 를 사용해도 매우 많은 기능을 제공합니다.</p>
<p>많은 기능 중 반복되는 값 - 예를 들면 기본 주소 -을 처리하기 위한 변수 기능을 좋아합니다. </p>
<h2 id="변수-Variable"><a href="#변수-Variable" class="headerlink" title="변수 Variable"></a>변수 <small>Variable</small></h2><h3 id="종류"><a href="#종류" class="headerlink" title="종류"></a>종류</h3><p>변수는 글로벌, 콜렉션, 환경, 데이터, 로컬 단위로 관리가 가능합니다. </p>
<blockquote>
<ul>
<li><a href="https://learning.getpostman.com/docs/postman/environments-and-globals/variables/#variable-scopes" target="_blank" rel="noopener">Variables scopes</a></li>
</ul>
</blockquote>
<p>전역 변수와 환경 변수는 오른쪽 위 버튼을 클릭하면 관리 화면을 찾을 수 있습니다.</p>
<img src="/2019/11/01/Postman-Variables-usages/postman-variable-usage-002.png" class="">

<blockquote>
<ul>
<li><a href="https://learning.getpostman.com/docs/postman/environments-and-globals/manage-globals/" target="_blank" rel="noopener">Managing global variables</a></li>
</ul>
</blockquote>
<p>콜렉션 변수는 콜렉션 편집 화면에서 찾을 수 있습니다.</p>
<blockquote>
<ul>
<li><a href="https://learning.getpostman.com/docs/postman/collections/managing-collections/#edit-and-view-collection-details" target="_blank" rel="noopener">Edit and view collection detail</a></li>
</ul>
</blockquote>
<h3 id="사용"><a href="#사용" class="headerlink" title="사용"></a>사용</h3><p>HTTP API 는 기본적으로 하나의 기능이 하나의 URI를 갖습니다.</p>
<p>인증처리를 하는 URI</p>
<pre class="line-numbers language-http" data-language="http"><code class="language-http">POST https://your-service.com/api/signin
&#123;
    "username": "&lt;your username>",
    "password": "&lt;your password>"
&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>매장 정보를 요청하는 URI</p>
<pre class="line-numbers language-http" data-language="http"><code class="language-http">GET https://your-service.com/api/stores
Authorization Bearer &lt;your token><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>Postman 을 사용하면 보통 한번만 작성한 후 저장하면, 다시 불러서 사용할 수 있습니다.</p>
<p>그런데, 동일한 API를 테스트 서버 대상, 스테이징 서버 대상, 프로덕션 서버 대상으로 테스트를 진행하려고 하면 주소 앞부분만 다르고 나머지 부분이 동일할 수 있습니다.</p>
<blockquote>
<p>해당 시나리오는 환경 변수를 사용하는 것이 더 좋겠습니다.</p>
</blockquote>
<p>예제 URI 의 <code>https://your-service.com</code> 부분이 다를 것입니다.</p>
<p>콜렉션 편집 화면을 열고 변수 탭에서 아래 이미지와 같이 변수를 추가합니다.</p>
<blockquote>
<p>기본주소를 <code>http://localhost:3000</code> 으로 설정합니다.</p>
</blockquote>
<img src="/2019/11/01/Postman-Variables-usages/postman-variable-usage-003.png" class="">


<h2 id="예제"><a href="#예제" class="headerlink" title="예제"></a>예제</h2><p>테스트 대상 웹 응용프로그램의 기본주소는 <code>http://localhost:3000</code> 입니다.</p>
<p><code>/api/signin</code> 끝점으로 POST 요청을 하면 token 데이터를 얻을 수 있습니다.</p>
<p><code>/api/stores</code> 끝점으로 요청 헤더에 Bearer 인증을 추가해서 GET 요청을 하면 사용자의 매장 정보를 얻을 수 있습니다.</p>
<pre class="line-numbers language-http" data-language="http"><code class="language-http">POST /api/signin

&#123;
    username,
    password
&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<pre class="line-numbers language-http" data-language="http"><code class="language-http">GET /api/stores
Authorization Bearer<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>Postman 컬렉션 편집 윈도우를 열고, 아래 변수 항목을 추가합니다.</p>
<table>
<thead>
<tr>
<th align="left">이름</th>
<th align="left">초기값</th>
<th align="left">현재값</th>
</tr>
</thead>
<tbody><tr>
<td align="left">baseurl</td>
<td align="left"></td>
<td align="left"><a href="http://localhost:3000/" target="_blank" rel="noopener">http://localhost:3000</a></td>
</tr>
<tr>
<td align="left">token</td>
<td align="left"></td>
<td align="left"></td>
</tr>
</tbody></table>
<p>Postman 의 현재 컬렉션에 signin 요청을 추가합니다.</p>
<p>요청 URL은 <code>&#123;&#123;baseurl&#125;&#125;/api/signin</code> 을 입력합니다.</p>
<img src="/2019/11/01/Postman-Variables-usages/postman-variable-usage-004.png" class="">

<p>응답에서 token 변수의 값을 설정하기 위해 Tests 탭으로 이동합니다.</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js">pm<span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span><span class="token string">'call'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">var</span> jsonData <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>responseBody<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>jsonData<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>jsonData<span class="token punctuation">.</span>success<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>jsonData<span class="token punctuation">.</span>data<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
                <span class="token keyword">const</span> token <span class="token operator">=</span> jsonData<span class="token punctuation">.</span>data<span class="token punctuation">.</span>token<span class="token punctuation">;</span>
                pm<span class="token punctuation">.</span>environment<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">"token"</span><span class="token punctuation">,</span> token<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// token 변수의 값을 설정</span>
            <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<img src="/2019/11/01/Postman-Variables-usages/postman-variable-usage-005.png" class="">

<blockquote>
<p>Test 탭의 오른쪽에 코드 조각이 제공됩니다.</p>
</blockquote>
<p>이제 <code>/api/signin</code> 끝점으로 요청을 보내면 응답 데이터에서 token 을 찾을 수 있으면 토큰 변수의 값이 설정됩니다.</p>
<p>Postman 의 현재 컬렉션에 get stores 요청을 추가합니다.</p>
<p>요청 URL은 <code>&#123;&#123;baseurl&#125;&#125;/api/stores</code> 를 입력합니다.</p>
<p>Authorization 탭에서 인증 형식을 Bearer Token 으로 선택하고 토큰의 값은 변수를 사용할 것이므로 <code>&#123;&#123;token&#125;&#125;</code> 을 입력합니다.</p>
<img src="/2019/11/01/Postman-Variables-usages/postman-variable-usage-006.png" class="">

<p>준비를 마쳤습니다.</p>
<p>Signin 요청을 먼저 실행해서 토큰을 얻고, Get stores 요청을 실행하면 이전 Signin 요청에서 얻은 토큰을 요청 헤더 인증 값으로 사용됩니다.</p>
<p>그리고, 테스트 서버의 기본 주소가 변경되면 컬렉션 변수의 값만 변경하면 해당 컬렉션 내의 요청이 변경된 기본주소를 참조할 것 입니다.</p>
<h2 id="오류-정정"><a href="#오류-정정" class="headerlink" title="오류 정정"></a>오류 정정</h2><p>2019-11-03 현재 컬렉션 변수는 스크립트 환경 <small>Pre-request Script, Tests</small> 에서 쓰기를 지원하지 않습니다.</p>
<p>스크립트로 변수 값 쓰기를 하려면 전역 변수 또는 환경 변수를 사용해야 합니다.</p>
<p>전역변수 쓰기</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js">pm<span class="token punctuation">.</span>globals<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">"token"</span><span class="token punctuation">,</span> token<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>환경변수 쓰기</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js">pm<span class="token punctuation">.</span>environment<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">"token"</span><span class="token punctuation">,</span> token<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<h2 id="참조"><a href="#참조" class="headerlink" title="참조"></a>참조</h2><ul>
<li><a href="https://learning.getpostman.com/" target="_blank" rel="noopener">Postman: Learning Center</a></li>
<li><a href="https://blog.getpostman.com/2014/01/27/extracting-data-from-responses-and-chaining-requests/" target="_blank" rel="noopener">Extracting data from response and chaning requests</a></li>
</ul>
</div></article></div></main><footer><div class="paginator"><a class="prev" href="/2019/09/29/Visual-Studio-Item-Template/"><i class="fa fa-arrow-left" aria-hidden="true"></i></a><a class="next" href="/2019/12/31/Review-2019/"><i class="fa fa-arrow-right" aria-hidden="true"></i></a></div><div class="copyright"><p>© 2019 - 2021 <a href="https://github.com/bbonkr" target="_blank">bbon</a>. Powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/stunstunstun/hexo-theme-chiangmai" target="_blank">hexo-theme-chiangmai</a>.</p></div></footer></div><script>(function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;e=o.createElement(i);r=o.getElementsByTagName(i)[0];e.src='//www.google-analytics.com/analytics.js';r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));ga('create','UA-64779499-1','auto');ga('send','pageview');</script></body></html>