{
    "componentChunkName": "component---src-templates-blog-post-tsx",
    "path": "/2020/11/23/migrate-webapps-to-container/",
    "result": {"data":{"site":{"siteMetadata":{"title":"<bbon />"}},"markdownRemark":{"id":"96f3fdf3-68a1-5a67-9c2d-01fc50589f8b","excerpt":"개요 AWS Lightsail 에서 실행되고 있는 두개의 웹 응용프로그램이 있습니다. 1 vCPU 프로세싱 512MB 메모리 20GB SSD 스토리지 3.5 USD 월별요금 1TB 전송 OS: Ubuntu 16.04 두 개의 웹 응용프로그램은 PHP 를 사용하고, nginx…","html":"<h2>개요</h2>\n<p>AWS Lightsail 에서 실행되고 있는 두개의 웹 응용프로그램이 있습니다.</p>\n<ul>\n<li>1 vCPU 프로세싱</li>\n<li>512MB 메모리</li>\n<li>20GB SSD 스토리지</li>\n<li>3.5 USD 월별요금</li>\n<li>1TB 전송</li>\n<li>OS: Ubuntu 16.04</li>\n</ul>\n<p>두 개의 웹 응용프로그램은 PHP 를 사용하고, nginx 를 사용해서 서비스되고 있습니다.</p>\n<p>혹시나 다른 서버로 이전하게 될 수도 있고, 관리도 힘들어서 구성을 코드화하고 싶어졌습니다.</p>\n<p>그래서, 두 응용프로그램을 컨테이너에서 실행될 수 있는 환경으로 이전했습니다.</p>\n<p>Lightsail 에 새로운 인스턴스를 만들고, Docker를 설치하고, docker-compose 로 구성 내용을 관리하도록 이전했습니다.</p>\n<ul>\n<li>1 vCPU</li>\n<li>1GB 메모리</li>\n<li>30GB SSD 스토리지</li>\n<li>5.0 USD 월별요금</li>\n<li>2TB 전송</li>\n<li>OS: Ubuntu 20.04</li>\n</ul>\n<h2>계획</h2>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/287ecd3bad08933ac625e4e23f2d0089/21b4d/aws-lightsail-container.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 56.32911392405063%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAIAAADwazoUAAAACXBIWXMAAA7DAAAOwwHHb6hkAAABvElEQVQoz4VQO28TYRD0/xcFDYICRItoQICiNFA5ilNEskhEcGxHxufz2T7b973fu4POSVoYrVbax2h2dkCEZif2R1vv2vmqXm+WUtRCVJ1oOnXouqUQKylWndycykqKWorVZrfQWg+ag3/5cfLq0/zNl+mLD7/PLuYgS6lDPgKMtOXio2uRBcCcNikosNFqaZ0btCK+/Tp79+3h/dns9ef788vFeHzzMJ9rLyWhWk5+3k6q5R86VOgOSe8uLq8P+9bbxlg7UDafj1bfr7c/ruvzq/rmvmL2XCSy4F65BXkU1QcV5D2SRVFaVda6AYCSQn9RtsQFSC4ZFQ2QwYy0Rt4ir1EMAGTDbQVy2nbWmp5srMuFjNcxZ+5XoApkhi/ZmVb1Bo4wW1iPY8cxAtBWPpG990zsgimU8YxAHECb9fR+OlvXC1INnAfR49RY9UQO3jOzj6ZQQf9TftQHF6QtWIOOKLKXifbX5HZ8M54u7pw7kZ21wQdtZCf3NhgXjQvGBm37bKzXNmgXjA9aOVE1i4flbHdogvcnz8ZcjUbD4XA+m+Wc0z9BRMwcY3Tu9G0i6tsxxhDS/xCfQaX8BeXmbhpFStp9AAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"aws lightsail container\"\n        title=\"aws lightsail container\"\n        src=\"/static/287ecd3bad08933ac625e4e23f2d0089/f058b/aws-lightsail-container.png\"\n        srcset=\"/static/287ecd3bad08933ac625e4e23f2d0089/c26ae/aws-lightsail-container.png 158w,\n/static/287ecd3bad08933ac625e4e23f2d0089/6bdcf/aws-lightsail-container.png 315w,\n/static/287ecd3bad08933ac625e4e23f2d0089/f058b/aws-lightsail-container.png 630w,\n/static/287ecd3bad08933ac625e4e23f2d0089/40601/aws-lightsail-container.png 945w,\n/static/287ecd3bad08933ac625e4e23f2d0089/78612/aws-lightsail-container.png 1260w,\n/static/287ecd3bad08933ac625e4e23f2d0089/21b4d/aws-lightsail-container.png 1280w\"\n        sizes=\"(max-width: 630px) 100vw, 630px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<h2>구현</h2>\n<p>호스트 <code class=\"language-text\">80</code>, <code class=\"language-text\">443</code> 포트는 nginx 컨테이너에 연결됩니다.</p>\n<p>DBMS 와 두 web app은 호스트 장치에 포트를 연결하지 않고, 컨테이너 내부에서만 접근할 수 있도록 <code class=\"language-text\">EXPOSE</code> 명령으로 구성합니다.</p>\n<p>도커 네트워크를 만들어서 사용합니다.</p>\n<p>nginx 에서 리버스 프록시 연결을 위한 네트워크와 web app 에서 DBMS 접근을 위한 네트워크를 분리하려고 했으나, 복잡해지는 것 같아 내부 네트워크는 하나만 사용하도록 구성합니다.</p>\n<h3>docker network</h3>\n<p>도커 네트워크를 작성합니다. 컨테이너는 작성된 네트워크로 연결됩니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">$ <span class=\"token function\">docker</span> network create <span class=\"token operator\">&lt;</span>name of network<span class=\"token operator\">></span></code></pre></div>\n<blockquote>\n<p>bridge 네트워크가 사용됩니다.</p>\n</blockquote>\n<h3>nginx</h3>\n<p>GUI 환경에서 관리할 수 있는 <a href=\"https://nginxproxymanager.com/\">Nginx Proxy Manager</a> 를 사용합니다.</p>\n<p>이제, 편리하게 GUI 환경에서 리버스 프록시를 관리할 수 있습니다.</p>\n<p>docker-compose.yml 파일을 작성해서 구성을 코드화합니다.</p>\n<h3>DBMS</h3>\n<p>docker-compose.yml 파일을 작성해서 구성을 코드화합니다.</p>\n<p>볼륨을 연결해서 데이터베이스 파일이 유지됩니다.</p>\n<h3>web apps</h3>\n<p>docker-compose.yml 파일을 작성해서 구성을 코드화하고, 볼륨을 연결해서 필요한 파일을 호스트에서 접근할 수 있고, 파일들이 컨테이너 외부에서 관리되어 계속 유지됩니다.</p>\n<h2>완료</h2>\n<p><a href=\"https://nginxproxymanager.com/\">Nginx Proxy Manager</a> 를 사용하면 도메인을 연결하고, 리버스 프록시 구성시 <a href=\"https://letsencrypt.org/\">Let’s Encrypt</a> 에서 인증서를 간편하게 구성하고, 재발행이 자동화되어 편리합니다.</p>\n<p>이제, 필요한 구성이 코드화되고, 필요한 파일은 호스트에서 확인할 수 있으므로 서버 이전을 매우 편리하게 진행할 수 있습니다.</p>\n<p>구성이 변경된 <a href=\"https://bbon.kr\">블로그: bbon.kr</a> web app 이 잘 동작하고 있습니다.</p>\n<h2>이슈</h2>\n<p>한번씩 CPU 사용량 급증하는 현상이 발생하고 있으나, 원인을 찾을 수 없습니다.</p>\n<p>적은 리소스로 서버를 모니터링할 수 있는 도구를 찾고 있습니다.</p>\n<h2>남은 사항</h2>\n<p><a href=\"https://nginxproxymanager.com/\">Nginx Proxy Manager</a>를 사용해서 리버스 프록시로 구성된 web app 의 도메인 별로 인증서를 사용하고 있는데, <a href=\"https://letsencrypt.org/\">Let’s Encrypt</a> 에서 제공하는 와일드카드 인증서를 사용하도록 구성해야 합니다.</p>\n<p>CPU 사용이 급증하는 현상의 원인을 파악하고, 해결해야 합니다.</p>","frontmatter":{"title":"Migrate web apps to container","date":"November 23, 2020","description":null,"categories":["log"],"tags":["docker","aws","lightsail","log","review"],"github":null,"image":null,"draft":null,"comments":null}},"previous":{"fields":{"slug":"/2020/11/15/react-starter-kit/"},"frontmatter":{"title":"React Starter Kit","image":null,"draft":null,"comments":null}},"next":{"fields":{"slug":"/2020/12/31/review-2020/"},"frontmatter":{"title":"Review 2020","image":null,"draft":null,"comments":null}}},"pageContext":{"id":"96f3fdf3-68a1-5a67-9c2d-01fc50589f8b","previousPostId":"9c2ac377-85a7-5700-a45c-e5f56f2f895c","nextPostId":"eb1f9bcd-ef60-5b6e-8af4-4263badf9e08"}},
    "staticQueryHashes": ["2568428658","3199328057"]}